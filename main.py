# -*- coding: utf-8 -*-
"""
Created on Wed Nov 18 15:43:09 2020

@author: aubin
"""
from recep_msg import *
import time


if __name__=='__main__':
    
    """ Connection au bus IVY """
    app_name="GUID_SEQ_APP"
    ivy_bus=""
    bus=IvyInit(app_name,"GUID_SEQ is Ready",0,on_cx,on_die)
    IvyStart(ivy_bus)
    time.sleep(1)
    
    """ Abonnement aux messages """
    
    IvyBindMsg(recepTime,'^Time t=(.*)')     # Reception du temps
    IvyBindMsg(recepMode, 'GC_AP Time=(.*) AP_State=(.*) AP_Mode=(.*)') # Reception du mode de l'AP (NAV ou HDG)

    IvyBindMsg(recepLegList,'^FL_LegList Time=(.*) LegList=(.*)')   # Reception de la liste des legs
    IvyBindMsg(recepBankAngles,'^GT Liste_BankAngles=(.*)')     # Reception des bankangles de la trajectoire

    # Reception de la trajectoire
    IvyBindMsg(recepPoints,'^GT Liste_Points=(.*)') # Reception des points
    IvyBindMsg(recepSegments,'^GT Liste_Segments=(.*)') # Reception des segments
    IvyBindMsg(recepOrthos, '^GT Liste_Orthos=(.*)') # Reception des orthos
    IvyBindMsg(recepTransitions,'^GT Liste_Transitions=(.*)') # Reception des transitions
    IvyBindMsg(recepPaths,'^GT Liste_Paths=(.*)') # Reception des paths
    
    # Reception du vecteur d'etat (position de l'avion et heading)
    IvyBindMsg(recepStateVector,'^StateVector x=(.*) y=(.*) z=(.*) Vp=(.*) fpa=(.*) psi=(.*) phi=(.*)') # Reception du vecteur d'Ã©tat 
    
    
    IvyMainLoop()
    
    
''' 
FL_LegList Time=0.0 LegList=(SEQ=0 TYPE=IF ID=LFMN LAT=N43395546 LONG=E007125394; SEQ=1 TYPE=TF ID=OKTET WPT_TYPE=Flyby LAT=N44290600 LONG=E006341000 COURSE=327 DISTANCE=63 FLmin=FL000 FLmax=FL195; SEQ=2 TYPE=TF ID=GIPNO WPT_TYPE=Flyby LAT=N45333600 LONG=E005314500 COURSE=325 DISTANCE=76 FLmin=FL195 FLmax=FL460; SEQ=3 TYPE=TF ID=BULOL WPT_TYPE=Flyby LAT=N46024500 LONG=E005053100 COURSE=345 DISTANCE=42 FLmin=FL195 FLmax=FL460; SEQ=4 TYPE=TF ID=MOMIL WPT_TYPE=Flyby LAT=N46324600 LONG=E004324800 COURSE=301 DISTANCE=35 FLmin=FL195 FLmax=FL460; SEQ=5 TYPE=TF ID=ATN WPT_TYPE=Flyby LAT=N46482140 LONG=E004153290 COURSE=323 DISTANCE=11 FLmin=FL000 FLmax=FL460; SEQ=6 TYPE=TF ID=AVLON WPT_TYPE=Flyby LAT=N47333600 LONG=E003484800 COURSE=332 DISTANCE=57 FLmin=FL195 FLmax=FL460; SEQ=7 TYPE=TF ID=OKRIX WPT_TYPE=Flyby LAT=N47575800 LONG=E003340300 COURSE=338 DISTANCE=15 FLmin=FL195 FLmax=FL460; SEQ=8 TYPE=TF ID=TELBO WPT_TYPE=Flyby LAT=N48252700 LONG=E002515300 COURSE=321 DISTANCE=52 FLmin=FL195 FLmax=FL460; SEQ=9 TYPE=TF ID=MLN WPT_TYPE=Flyby LAT=N48272080 LONG=E002484780 COURSE=313 DISTANCE=1 FLmin=FL195 FLmax=FL460; SEQ=10 TYPE=TF ID=AGOGO WPT_TYPE=Flyby LAT=N48311200 LONG=E002423800 COURSE=313 DISTANCE=3 FLmin=FL000 FLmax=FL460; SEQ=11 TYPE=TF ID=LFRG WPT_TYPE=Flyby LAT=N49214822 LONG=E000093599 COURSE=301 DISTANCE=106 FLmin=FL000 FLmax=FL195)
GT Liste_Points=[Point(433.6604773178687, 2923.2118911359084),Point(394.87430364484646, 2991.796113659577),Point(332.3455819894574, 3083.216580837434),Point(306.06515264751283, 3125.10641933703),Point(273.289750615596, 3168.628510981895),Point(255.99208555952578, 3191.3814894610828),Point(229.21075858082247, 3258.0800194449575),Point(214.43427829643812, 3294.394590662351),Point(172.19191092978016, 3335.698381668839),Point(169.08634558187563, 3338.542364200144),Point(162.92530464974254, 3344.3868530075733),Point(9.600538037876815, 3421.5647089876284)]
GT Liste_Segments=[Segment(Liste_Points[0], Liste_Points[1]),Segment(Liste_Points[1], Liste_Points[2]),Segment(Liste_Points[2], Liste_Points[3]),Segment(Liste_Points[3], Liste_Points[4]),Segment(Liste_Points[4], Liste_Points[5]),Segment(Liste_Points[5], Liste_Points[6]),Segment(Liste_Points[6], Liste_Points[7]),Segment(Liste_Points[7], Liste_Points[8]),Segment(Liste_Points[8], Liste_Points[9]),Segment(Liste_Points[9], Liste_Points[10]),Segment(Liste_Points[10], Liste_Points[11])]
GT Liste_Transitions=[Transition("Flyby",[Arc(Point(353.559474250997, 2966.0497761605293), 48.63631380275426, 2.0731623520029023)]), Transition("Flyby",[Arc(Point(373.0335163707762, 3109.879473695359), 48.63631380275426, 0.962725013553354)]), Transition("Flyby",[Arc(Point(265.9668903448254, 3097.5036153452265), 48.63631380275426, 2.0722952456280352)]), Transition("Flyby",[Arc(Point(234.50475164382635, 3139.2818392265053), 48.63631380275426, 0.1107611790226753)]), Transition("Flyby",[Arc(Point(283.67602088078655, 3207.0826942325284), 31.540799103314285, 4.255126093430421)]), Transition("Flyby",[Arc(Point(184.11875303128994, 3239.853262315486), 48.63631380275426, 0.11233706346500198)]), Transition("Flyby",[Arc(Point(197.09108282757046, 3282.7437059227514), 20.455401394639093, 4.255126093430421)]), Transition("Flyby",[Arc(Point(138.75805522353852, 3300.3670788352097), 48.63631380275426, 0.7953910908560351)]), Transition("Flyby",[Arc(Point(202.24885988378662, 3374.122153260108), 48.63631380275426, 0.4274623445175853)]), Transition("Flyby",[Arc(Point(146.1456140309068, 3320.5155615908643), 28.86677108881954, 4.2551260934304205)]),  None]
GT Liste_Orthos=[Ortho(Point(433.6604773178687, 2923.2118911359084), Point(395.8948405185609, 2989.99153431049)), Ortho(Point(393.70390429529704, 2993.5073025738516), Point(332.8890863264763, 3082.421947282037)), Ortho(Point(331.8339496083046, 3084.032100155585), Point(307.1664571072972, 3123.350988885001)), Ortho(Point(304.81852002446743, 3126.761808925076), Point(273.3563813234683, 3168.5400328063547)), Ortho(Point(273.22271761204837, 3168.716684760389), Point(258.5673008563772, 3187.994106364081)), Ortho(Point(254.40657139718945, 3195.3301908820595), Point(229.2526168010416, 3257.975772117759)), Ortho(Point(229.16841924209874, 3258.184072297991), Point(216.03801636315498, 3290.4532555732785)), Ortho(Point(211.39183990744752, 3297.369429602561), Point(172.76061990242792, 3335.1423087493013)), Ortho(Point(171.60532307076446, 3336.2355610346644), Point(169.40159203656066, 3338.2536710606537)), Ortho(Point(168.77622205602572, 3338.836553687881), Point(166.01239459802756, 3341.458376659335)), Ortho(Point(159.12452913063188, 3346.300018845738), Point(9.600538037876815, 3421.5647089876284))]
GT Liste_Orthos=[Ortho(Point(433.6604773178687, 2923.2118911359084), Point(395.8948405185609, 2989.99153431049)), Ortho(Point(393.70390429529704, 2993.5073025738516), Point(332.8890863264763, 3082.421947282037)), Ortho(Point(331.8339496083046, 3084.032100155585), Point(307.1664571072972, 3123.350988885001)), Ortho(Point(304.81852002446743, 3126.761808925076), Point(273.3563813234683, 3168.5400328063547)), Ortho(Point(273.22271761204837, 3168.716684760389), Point(258.5673008563772, 3187.994106364081)), Ortho(Point(254.40657139718945, 3195.3301908820595), Point(229.2526168010416, 3257.975772117759)), Ortho(Point(229.16841924209874, 3258.184072297991), Point(216.03801636315498, 3290.4532555732785)), Ortho(Point(211.39183990744752, 3297.369429602561), Point(172.76061990242792, 3335.1423087493013)), Ortho(Point(171.60532307076446, 3336.2355610346644), Point(169.40159203656066, 3338.2536710606537)), Ortho(Point(168.77622205602572, 3338.836553687881), Point(166.01239459802756, 3341.458376659335)), Ortho(Point(159.12452913063188, 3346.300018845738), Point(9.600538037876815, 3421.5647089876284))]
GT Liste_BankAngles=[-5, 5, -5, -5, 7.683306468098666, -5, -11.751064498067521, -5, 5, -8.385338012849845,  None]'
GT Liste_Paths=[Path(Liste_Orthos[0], Liste_Transitions[0]), Path(Liste_Orthos[1], Liste_Transitions[1]), Path(Liste_Orthos[2], Liste_Transitions[2]), Path(Liste_Orthos[3], Liste_Transitions[3]), Path(Liste_Orthos[4], Liste_Transitions[4]), Path(Liste_Orthos[5], Liste_Transitions[5]), Path(Liste_Orthos[6], Liste_Transitions[6]), Path(Liste_Orthos[7], Liste_Transitions[7]), Path(Liste_Orthos[8], Liste_Transitions[8]), Path(Liste_Orthos[9], Liste_Transitions[9]), Path(Liste_Orthos[10], Transition(None, None))]
'''
